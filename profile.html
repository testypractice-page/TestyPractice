<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TESTY ‚Äì Profile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Font Awesome -->
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <!-- Favicons (same as other pages) -->
  <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
  <link rel="manifest" href="favicon/site.webmanifest">
  <link rel="icon" type="image/png" sizes="192x192" href="favicon/android-chrome-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="favicon/android-chrome-512x512.png">
  <link rel="shortcut icon" href="favicon/favicon.ico">

  <!-- Main shared styles -->
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <!-- ========== PRELOADER ========== -->
  <div id="preloader" class="preloader">
    <div class="preloader-card">
      <div class="preloader-logo">TESTY</div>
      <div class="preloader-sub">Loading your questions‚Ä¶</div>
      <div class="preloader-bar">
        <div class="preloader-bar-inner"></div>
      </div>
    </div>
  </div>

  <!-- ========== HEADER ========== -->
  <header class="top-bar">
    <div class="logo">TESTY</div>

    <nav class="top-nav">
      <a href="index.html">Home</a>
      <a href="auth.html">Login</a>
      <a href="rtp_mtp.html">RTP/MTP</a>
      <a href="settings.html">Settings</a>
      <a href="about.html">About</a>
      <a href="feedback.html">Drop Suggestion</a>
      <a href="sponsor.html">Sponsor</a>
    </nav>

    <div class="right-controls">
      <button class="top-btn" id="themeToggle">üåô</button>
      <button class="top-btn" id="menuBtn"><i class="fas fa-bars"></i></button>
    </div>
  </header>

  <!-- ========== LEFT SIDEBAR ========== -->
  <div class="left-handle" id="leftHandle"></div>

  <aside class="left-sidebar" id="leftSidebar">
    <ul class="left-list">
      <li data-page="profile">
        <a href="profile.html" class="left-link">
          <span class="left-icon-box"><i class="fa-solid fa-user"></i></span>
          My Profile
        </a>
      </li>

      <li>
        <a href="bookmarks.html" class="left-link">
          <span class="left-icon-box"><i class="fa-solid fa-bookmark"></i></span>
          Bookmarks
        </a>
      </li>

      <li>
        <a href="#" class="left-link">
          <span class="left-icon-box"><i class="fa-solid fa-trophy"></i></span>
          Leaderboard
        </a>
      </li>

      <li>
        <a href="#" class="left-link">
          <span class="left-icon-box"><i class="fa-solid fa-comments"></i></span>
          Chatrooms
        </a>
      </li>

      <li>
        <a href="articles/How To Overcome Overthinking while exams.html" class="left-link">
          <span class="left-icon-box"><i class="fa-solid fa-note-sticky"></i></span>
          Article
        </a>
      </li>

      <li>
        <a href="wrongs.html" class="left-link">
          <span class="left-icon-box"><i class="fa-solid fa-pen-to-square"></i></span>
          Take a Correction Test
        </a>
      </li>
    </ul>
  </aside>
  <div class="left-overlay" id="leftOverlay"></div>

  <!-- ========== RIGHT SIDEBAR ========== -->
  <aside class="right-sidebar" id="rightSidebar">
    <div class="right-header">
      <span>TESTY Menu</span>
      <button class="right-close" id="rightClose">‚úï</button>
    </div>
    <ul class="right-links">
      <li><a href="index.html">Home</a></li>
      <li><a href="auth.html">Login / Signup</a></li>
      <li><a href="rtp_mtp.html">RTP/MTP</a></li>
      <li><a href="settings.html">Settings</a></li>
      <li><a href="about.html">About</a></li>
      <li><a href="index.html">Chapters</a></li>
      <li><a href="sponsor.html">Sponsor</a></li>
      <li><a href="feedback.html">Drop Suggestion</a></li>
    </ul>
  </aside>
  <div class="right-overlay" id="rightOverlay"></div>

  <!-- ========== MAIN AREA (EMPTY CENTER) ========== -->
<!-- === PROFILE MAIN UI (put inside <body> after header + sidebars) === -->
<main class="profile-main">
  <!-- Top profile header bar -->
  <div class="profile-header-bar">
    <h1 class="profile-title">My Profile</h1>

    <button type="button" class="profile-back-btn" id="profileBackBtn">
      <!-- optional Font Awesome icon -->
      <i class="fa-solid fa-arrow-left"></i>
      Back
    </button>
  </div>

  <!-- Horizontal stat cards -->
  <section class="profile-metrics-row">
    <div class="profile-metric-card">
      <div class="profile-metric-value" id="profileStreakValue">0</div>
      <div class="profile-metric-label">Streak</div>
    </div>

    <div class="profile-metric-card">
      <div class="profile-metric-value" id="profileMostXpValue">0</div>
      <div class="profile-metric-label">Most XP</div>
    </div>

    <div class="profile-metric-card">
      <div class="profile-metric-value">‚Äî</div>
      <div class="profile-metric-label">In Future</div>
    </div>

    <div class="profile-metric-card">
      <div class="profile-metric-value">‚Äî</div>
      <div class="profile-metric-label">In Future</div>
    </div>
  </section>
<section class="profile-graph-card">
  <div class="profile-graph-header">
    <div class="profile-graph-title">XP This Week</div>
    <div class="profile-graph-subtitle">Mon ‚Äì Sun</div>
  </div>

  <!-- Chart.js line graph lives INSIDE this card now -->
  <div class="profile-graph-body">
    <canvas id="xpWeekChart"></canvas>
  </div>
<hr class="dashed">
  <div class="profile-graph-footer">
    XP this Week: <span id="profileWeekXpValue">0</span>
  </div>
</section>
</main>

<!-- Simple back button behaviour -->
<script>
  (function () {
    const backBtn = document.getElementById("profileBackBtn");
    if (!backBtn) return;

    backBtn.addEventListener("click", () => {
      // Try to go back to previous page, otherwise fallback to home
      if (window.history.length > 1) {
        window.history.back();
      } else {
        window.location.href = "index.html";
      }
    });
  })();
</script>

  <!-- ========== SCRIPT: THEME + SIDEBARS ========== -->
  <script>
    /* ------- THEME (shared with other pages) ------- */
    const themeToggle = document.getElementById("themeToggle");
    const savedTheme  = localStorage.getItem("theme");

    if (savedTheme === "dark") {
      document.body.classList.add("dark");
    }
    if (themeToggle) {
      themeToggle.textContent = document.body.classList.contains("dark") ? "‚òÄÔ∏è" : "üåô";
    }

    function setTheme(isDark) {
      document.body.classList.toggle("dark", isDark);
      localStorage.setItem("theme", isDark ? "dark" : "light");
      if (themeToggle) themeToggle.textContent = isDark ? "‚òÄÔ∏è" : "üåô";
    }

    if (themeToggle) {
      themeToggle.addEventListener("click", () => {
        setTheme(!document.body.classList.contains("dark"));
      });
    }

    // apply left-sidebar hidden setting (from settings page)
    const hideLS = localStorage.getItem("set_leftSidebarHidden") === "1";
    document.body.classList.toggle("hide-left-sidebar", hideLS);

    /* ------- RIGHT SIDEBAR ------- */
    const menuBtn      = document.getElementById("menuBtn");
    const rightSidebar = document.getElementById("rightSidebar");
    const rightOverlay = document.getElementById("rightOverlay");
    const rightClose   = document.getElementById("rightClose");

    function openRightSidebar() {
      if (!rightSidebar || !rightOverlay) return;
      rightSidebar.classList.add("open");
      rightOverlay.classList.add("show");
    }
    function closeRightSidebar() {
      if (!rightSidebar || !rightOverlay) return;
      rightSidebar.classList.remove("open");
      rightOverlay.classList.remove("show");
    }

    if (menuBtn)    menuBtn.addEventListener("click", openRightSidebar);
    if (rightClose) rightClose.addEventListener("click", closeRightSidebar);
    if (rightOverlay) rightOverlay.addEventListener("click", closeRightSidebar);

    /* ------- LEFT SIDEBAR + SWIPE ------- */
    const leftSidebar = document.getElementById("leftSidebar");
    const leftOverlayEl = document.getElementById("leftOverlay");
    const leftHandle  = document.getElementById("leftHandle");

    function openLeftSidebar() {
      if (!leftSidebar || !leftOverlayEl) return;
      leftSidebar.classList.add("open");
      leftOverlayEl.classList.add("show");
    }
    function closeLeftSidebar() {
      if (!leftSidebar || !leftOverlayEl) return;
      leftSidebar.classList.remove("open");
      leftOverlayEl.classList.remove("show");
    }

    if (leftHandle)  leftHandle.addEventListener("click", openLeftSidebar);
    if (leftOverlayEl) leftOverlayEl.addEventListener("click", closeLeftSidebar);

    let startX = null;
    if (leftHandle) {
      leftHandle.addEventListener("touchstart", (e) => {
        startX = e.touches[0].clientX;
      }, { passive: true });

      leftHandle.addEventListener("touchend", (e) => {
        if (startX == null) return;
        const diff = e.changedTouches[0].clientX - startX;
        if (diff > 40) openLeftSidebar();
        startX = null;
      }, { passive: true });
    }

    if (leftSidebar) {
      leftSidebar.addEventListener("touchstart", (e) => {
        startX = e.touches[0].clientX;
      }, { passive: true });

      leftSidebar.addEventListener("touchend", (e) => {
        if (startX == null) return;
        const diff = startX - e.changedTouches[0].clientX;
        if (diff > 40) closeLeftSidebar();
        startX = null;
      }, { passive: true });
    }
  </script>

  <!-- ========== SCRIPT: MINIMAL THEME + LEFT-SIDEBAR HIDE SETTING (SAFE IF MISSING CONTROLS) ========== -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const SETTINGS_KEYS = {
        leftSidebarHidden:  "set_leftSidebarHidden",
        randomizeQuestions: "set_randomizeQuestions",
        randomizeOptions:   "set_randomizeOptions",
        showLetters:        "set_showLetters",
        timerOn:            "set_timerOn",
        autoSkip:           "set_autoSkip",
        questionTime:       "set_questionTimeSeconds",
        rtpMtpExamMode:     "set_rtpMtpExamMode"
      };

      // minimal theme
      const minimalSwitch = document.getElementById("Minimilist");
      const minimalSaved  = localStorage.getItem("minimalTheme") === "1";
      if (minimalSaved) document.body.classList.add("minimal-theme");
      if (minimalSwitch) minimalSwitch.checked = minimalSaved;
      if (minimalSwitch) {
        minimalSwitch.addEventListener("change", () => {
          const ON = minimalSwitch.checked;
          localStorage.setItem("minimalTheme", ON ? "1" : "0");
          document.body.classList.toggle("minimal-theme", ON);
        });
      }

      // apply leftSidebarHidden if some control exists on other pages
      function applyLeftSidebarVisibility(hidden) {
        document.body.classList.toggle("hide-left-sidebar", hidden);
      }
      const leftHiddenInit = localStorage.getItem(SETTINGS_KEYS.leftSidebarHidden) === "1";
      applyLeftSidebarVisibility(leftHiddenInit);
    });
  </script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // === XP weekly line graph INSIDE profile-graph-card ===
  (function () {
    const DAILY_XP_KEY = "quizDailyXp";
    const weekLabels = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"];

    function loadDailyXp() {
      try {
        const raw = localStorage.getItem(DAILY_XP_KEY);
        const obj = raw ? JSON.parse(raw) : {};
        return obj && typeof obj === "object" ? obj : {};
      } catch {
        return {};
      }
    }

    // Returns { values: [7 numbers], totalWeek }
    function getWeekData() {
      const today = new Date();

      // convert JS day (0=Sun) to our index (0=Mon..6=Sun)
      const jsDay = today.getDay();          // 0..6
      const monOffset = (jsDay + 6) % 7;     // how many days since Monday

      const monday = new Date(today);
      monday.setDate(today.getDate() - monOffset);

      const daily = loadDailyXp();
      const values = [];
      let total = 0;

      for (let i = 0; i < 7; i++) {
        const d = new Date(monday);
        d.setDate(monday.getDate() + i);

        const y = d.getFullYear();
        const m = String(d.getMonth() + 1).padStart(2, "0");
        const day = String(d.getDate()).padStart(2, "0");
        const key = `${y}-${m}-${day}`;

        const xp = daily[key] || 0;
        values.push(xp);
        total += xp;
      }
      return { values, totalWeek: total };
    }

    function initWeekChart() {
      const canvas = document.getElementById("xpWeekChart");
      if (!canvas || typeof Chart === "undefined") return;

      const { values, totalWeek } = getWeekData();

      const totalSpan = document.getElementById("profileWeekXpValue");
      if (totalSpan) totalSpan.textContent = totalWeek;

      new Chart(canvas, {
        type: "line",
        data: {
          labels: weekLabels,
          datasets: [{
            data: values,
            tension: 0.35,
            borderWidth: 2,
            pointRadius: 4,
            pointHitRadius: 8,
            fill: false
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false },
            tooltip: { enabled: true }
          },
          scales: {
            x: {
              grid: { display: false }
            },
            y: {
              beginAtZero: true,
              ticks: { stepSize: 5 },
              grid: { display: true }
            }
          }
        }
      });
    }

    // run after DOM is ready
    document.addEventListener("DOMContentLoaded", initWeekChart);
  })();
</script>
  <!-- ========== SCRIPT: PRELOADER + MAKE LEFT ROWS CLICKABLE ========== -->
  <script>
    // Hide preloader once page is ready
    window.addEventListener("load", function () {
      const pre = document.getElementById("preloader");
      if (!pre) return;
      pre.classList.add("hidden");
      setTimeout(() => {
        if (pre && pre.parentNode) {
          pre.parentNode.removeChild(pre);
        }
      }, 300);
    });

    // Make full <li> clickable in left sidebar
    document.querySelectorAll(".left-sidebar .left-list li").forEach(li => {
      const anchor = li.querySelector("a");
      if (anchor) {
        li.style.cursor = "pointer";
        li.addEventListener("click", (e) => {
          if (e.target.closest("a")) return;
          window.location = anchor.getAttribute("href");
        });
      } else {
        const dh = li.dataset.href;
        if (dh) {
          li.style.cursor = "pointer";
          li.addEventListener("click", () => { window.location = dh; });
        }
      }
    });
  </script>
<script>
  (function () {
    const STREAK_KEY        = "quizDayStreak";
    const MOST_DAILY_XP_KEY = "quizMostDailyXp";

    const streakEl = document.getElementById("profileStreakValue");
    const mostEl   = document.getElementById("profileMostXpValue");

    let streak = parseInt(localStorage.getItem(STREAK_KEY), 10);
    if (isNaN(streak) || streak < 0) streak = 0;

    let most = parseInt(localStorage.getItem(MOST_DAILY_XP_KEY), 10);
    if (isNaN(most) || most < 0) most = 0;

    if (streakEl) streakEl.textContent = String(streak);
    if (mostEl)   mostEl.textContent   = String(most);
  })();
</script>
  <!-- ========== PAGE ID FOR shared.js (for active highlight) ========== -->
  <script>
    const currentPage = "profile";
  </script>
  <script src="shared.js"></script>

  <!-- ========== FOOTER ========== -->
  <footer class="simple-footer">
    <div>Made with ‚ô•Ô∏è</div>
    <div>Kunal Sharma ‚Ä¢ CA Foundation</div>
  </footer>
  <script>
    // ensure footer is at bottom of main content wrapper
    (function() {
      const footer = document.querySelector('.simple-footer');
      if (!footer) return;
      const main = document.querySelector('main') ||
                   document.querySelector('.page-wrapper') ||
                   document.body;
      if (!main) return;
      if (footer.parentElement !== main) {
        main.appendChild(footer);
      }
    })();
  </script>
</body>
</html>